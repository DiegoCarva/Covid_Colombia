"""
Created on Sat Apr 18 11:19:11 2020
@author: Juan Diego Carvajalino Olave
"""

import pandas as pd
import requests
import datetime as dt

# URL donde se encuetra el JSON del infograma del INS. 
#Es posible encontrar otras URL que descarguen otras hojas de cálculo del infograma
url1 = "https://atlas.jifo.co/api/connectors/e160e2f9-a7b9-4f01-879e-cc497cb279eb"
url = [url1]


# Acá se guardan las hojas de cálculo
for url in url:
    Raw = requests.get(url).json()
    Sheets = []
    
    # Nombre del archivo a guardar
    fileName = Raw['fileName']+'_(version {})_'.format(Raw['version']) + dt.datetime.now().strftime('%d-%m-%Y')+'.xlsx'
    NewFile = pd.DataFrame([Raw['version']],columns = ['version']).to_excel(fileName,sheet_name='version',index=False)
    
    # Se guarda toda la información en formato 'texto', por lo que no incluye las fórmulas que pueda tener el documento original
    with pd.ExcelWriter(fileName,engine= 'openpyxl',mode='a') as writer:
        for n,sheetName in enumerate(Raw['sheetNames']):
            Sheets.append(pd.DataFrame(Raw['data'][n]))
            Sheets[n].to_excel(writer, sheet_name=sheetName, index=False, header=False)
